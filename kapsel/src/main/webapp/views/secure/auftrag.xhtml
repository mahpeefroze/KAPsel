<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui">

<h:outputStylesheet name="global.css" library="css" />
<h:outputStylesheet name="auftrag.css" library="css" />

<f:metadata>
	<f:viewParam name="pA" value="#{auftragBean.passedID}"/>
	<f:viewAction action="#{auftragBean.loadPassedAuftrag()}" />
</f:metadata>

<h:head>

	<title>#{labels.progName} #{labels.auftrag}</title>

</h:head>

<body>

	<!-- OBEN, HIER KOMMT DER RIBBON REIN -->
	<div id="header" class="float_frame">
		<h:form id="ribbon_form">
			<p:ribbon>
				<p:tab title="#{labels.auftrag}">
					<p:ribbonGroup>
						<h1>#{labels.auftraege}</h1>
					</p:ribbonGroup>

					<p:ribbonGroup label="#{labels.action}">
						<p:commandButton disabled="#{loginBean.validateAccess('ADVUSER')}" value="#{labels.add}" icon="fa fa-file-text-o"
							styleClass="ui-ribbon-bigbutton" update="auftragNewDlg" oncomplete="PF('newAuftrag').show();"/>
						<p:commandButton disabled="#{loginBean.validateAccess('ADVUSER')}" value="#{labels.edit}" icon="fa fa-edit"
							styleClass="ui-ribbon-bigbutton" update="ribbon_form" onclick="lockSelection()" /> 
						<p:commandButton disabled="#{loginBean.validateAccess('ADVUSER') or auftragBean.emptyList}" value="#{labels.delete}" icon="fa fa-trash"
							styleClass="ui-ribbon-bigbutton" oncomplete="PF('delAuftrag').show();"/>
					</p:ribbonGroup>
					
					<p:ribbonGroup id="editControls" label="#{labels.edit}" rendered="#{auftragBean.editMode}">
						<p:commandButton value="#{labels.ok}" icon="fa fa-check"
							styleClass="ui-ribbon-bigbutton" update="ribbon_form" onclick="editSectOk()" />
						<p:commandButton value="#{labels.cancel}" icon="fa fa-times"
							styleClass="ui-ribbon-bigbutton" update="ribbon_form" onclick="editSectCancel()" oncomplete="unlockSelection()"/>
					</p:ribbonGroup>

					<p:ribbonGroup label="#{labels.export}">
						<p:commandButton value="To PDF" icon="fa fa-file-pdf-o"
							styleClass="ui-ribbon-bigbutton" type="button" />
						<p:commandButton value="To Word" icon="fa fa-file-word-o"
							styleClass="ui-ribbon-bigbutton" type="button" />
					</p:ribbonGroup>

					<p:ribbonGroup label="#{labels.print}">
						<p:commandButton value="Print" icon="fa fa-print"
							styleClass="ui-ribbon-bigbutton" type="button" />
					</p:ribbonGroup>
					
					<p:ribbonGroup label="Optionen" style="float: right;">
						<p:commandButton value="#{labels.menu}" icon="fa fa-home" styleClass="ui-ribbon-bigbutton" action="index?faces-redirect=true"/>
					</p:ribbonGroup>
					
				</p:tab>

			</p:ribbon>
			
		</h:form>
		
		
	</div>


	<div id="middle">


		<!-- LINKE SEITE -->
		<h:form id="nav_form">
			<p:remoteCommand name="lockSelection" update="nav_form" action="#{auftragBean.enableEditMode()}"/>
			<p:remoteCommand name="unlockSelection" update="nav_form" />
			<div id="nav_container">
				<div id="nav" class="float_frame">

					<!-- Tabelle mit allen Aufträgen -->
					<p:dataTable id="auftragDT" var="item"
						value="#{auftragBean.auftraege}" selectionMode="single"
						selection="#{auftragBean.selectedAuftrag}" disabledSelection="#{auftragBean.editMode}"
						rowKey="#{item.anr}" emptyMessage="#{errors.norecords}">
						<f:facet name="header">#{labels.auftragListe}</f:facet>


						<p:ajax event="rowSelect" listener="#{auftragBean.loadAuftrag}"
							update=":sect_form" />
						<!-- 
					<p:ajax event="rowUnselect" listener="#{AuftragBean.clearAuftrag}" update="auftrag.xhtml:section_container" />
					-->

						<p:column headerText="#{labels.a_nr}">
							<h:outputText value="#{item.anr}" />
						</p:column>
						<p:column headerText="#{labels.nachname}">
							<h:outputText value="#{item.name}" />
						</p:column>
						<p:column headerText="#{labels.terminL}">
							<h:outputText value="#{item.sollenddatum}">
								<f:convertDateTime pattern="dd.MM.yyyy" />
							</h:outputText>
						</p:column>
						<p:column headerText="#{labels.kunde}">
							<h:outputText value="#{item.kunde.name}" />
						</p:column>
					</p:dataTable>

					<hr></hr>
				</div>
			</div>
		</h:form>

		<!-- RECHTE SEITE -->
		<h:form id="sect_form">
			<p:remoteCommand name="editSectOk" process="@form" update="sect_form" action="#{auftragBean.onEditComplete()}"/>
			<p:remoteCommand name="editSectCancel" process="@form" update="sect_form"  action="#{auftragBean.cancelEditMode()}"/>
			<div id="section_container">
				<div id="section" class="float_frame">
					
					<p:accordionPanel multiple="true">


						<!-- Auftragsdetails -->
						<p:tab title="#{labels.auftragDetail}">
							<br></br>
								<h:panelGrid columns="2" styleClass="fullWidth">
									<h:outputText value="#{auftragBean.selectedAuftrag.name}" />
									<h:outputText id="statusbox" value="#{labels.status}: #{auftragBean.selectedAuftrag.status}" />
								</h:panelGrid>
							<br></br>
							<p:fieldset style="margin-bottom:10px;">
								<p:panelGrid>
									<p:row>
										<p:column>#{labels.anr}:</p:column>
										<p:column>#{auftragBean.selectedAuftrag.anr}</p:column>
										<p:column>#{labels.startDatum}:</p:column>
										<p:column>
											<h:outputText value="#{auftragBean.selectedAuftrag.startdatum}">
												<f:convertDateTime pattern="dd.MM.yyyy" />
											</h:outputText>
										</p:column>
									</p:row>
									<p:row>
										<p:column>#{labels.kunde}:</p:column>
										<p:column>
											<p:commandLink
												value="#{auftragBean.selectedAuftrag.kunde.name}" action="#{auftragBean.redirectToKunde(auftragBean.selectedAuftrag.kunde.id)}"/>
										</p:column>
										<p:column>#{labels.terminL}:</p:column>
										<p:column>
											<h:outputText value="#{auftragBean.selectedAuftrag.sollenddatum}">
												<f:convertDateTime pattern="dd.MM.yyyy" />
											</h:outputText>
										</p:column>
									</p:row>
									<p:row>
										<p:column>#{labels.verantwortlichMA}:</p:column>
										<p:column>#TestMA</p:column>
										<p:column></p:column>
										<p:column></p:column>
									</p:row>
								</p:panelGrid>
							</p:fieldset>
							<p:fieldset legend="#Beschreibung" toggleable="true"
								toggleSpeed="800">
								<h:outputText value="#{auftragBean.selectedAuftrag.text}"></h:outputText>
							</p:fieldset>
							<br></br>
						</p:tab>

						<!-- Produkte und Leistungen -->
						<p:tab title="#{labels.prodLeist}">
						
							<p:commandButton update="produktDT" title="#{labels.add}" rendered="#{auftragBean.editMode}" icon="fa fa-plus" actionListener="#{auftragBean.addProduktWrapper()}" />
							<p:commandButton update="produktDT" title="#{labels.delete}" rendered="#{auftragBean.editMode}" icon="fa fa-remove" actionListener="#{auftragBean.deleteProduktWrapper()}" />

							<!-- Tabelle mit allen Produkten und Leistungen -->
							<p:dataTable id="produktDT" var="item"
								value="#{auftragBean.pwToList()}" rowKey="#{item.id}" editable="#{auftragBean.editMode}" editMode="cell"
								selectionMode="single" selection="#{auftragBean.selectedProduktWrapper}" emptyMessage="#{errors.norecords}" sortBy="#{item.position}">

								<p:column headerText="#{labels.position}">
									<h:outputText value="#{item.position}" />
								</p:column>
								<p:column headerText="#{labels.p_nr}">
									<h:outputText value="#{item.produkt.pnr}" />
								</p:column>
								<p:column headerText="#{labels.stueckzahl}">
									<h:outputText value="#{item.stueckzahl}" />
								</p:column>
								<p:column headerText="#{labels.bezeichnung}">
									<h:outputText value="#{item.produkt.name}" />
								</p:column>
								<p:column headerText="#{labels.typ}">
									<h:outputText value="#{item.produkt.typ}" />
								</p:column>
								<p:column headerText="Kosten">
									<h:outputText value="#{item.produkt.preis}" />
								</p:column>
								<p:column headerText="Zeit">
									<h:outputText value="#{item.produkt.zeit}" />
								</p:column>

							</p:dataTable>
						</p:tab>


						<!-- Dokumente -->
						<p:tab title="#{labels.doc}">

							<p:tabView>
								<p:tab title="Übersicht">
									<h:outputText value="Aktuelle Versionen von Dateien" />
									<p:panelGrid>
										<p:row>
											<p:column>Angebot</p:column>
											<p:column></p:column>
										</p:row>
										<p:row>
											<p:column>Auftragsbestätigung</p:column>
											<p:column></p:column>
										</p:row>
										<p:row>
											<p:column>Abschlagsrechnung</p:column>
											<p:column></p:column>
										</p:row>
										<p:row>
											<p:column>Rechnung</p:column>
											<p:column></p:column>
										</p:row>
										<p:row>
											<p:column>Lieferschein</p:column>
											<p:column></p:column>
										</p:row>
									
									</p:panelGrid>
								</p:tab>
								<p:tab title="Angebote">
									<h:outputText value="Angebote für den Kunden" />
								</p:tab>
								<p:tab title="Auftragsbestätigung">
									<h:outputText
										value="Bestätigung durch Kunden - Eingescannte datei/email" />
								</p:tab>
								<p:tab title="Abschlagsrechnung">
									<h:outputText
										value="Teilrechnung wenn ein Teil der Leistungen erledigt wurden" />
								</p:tab>
								<p:tab title="Rechnung">
									<h:outputText value="End/gesamtrechnung für die Bestellung" />
								</p:tab>
								<p:tab title="Briefe und Gesprächsprotokolle">
									<h:outputText value="Briefe an und von Kunden" />
								</p:tab>
								<p:tab title="Lieferschein">
									<h:outputText value="Lieferschein für Kunden" />
								</p:tab>
							</p:tabView>
						</p:tab>

						<p:tab title="#{labels.dateien}">

							<h:form>

								<p:fileUpload value="#{fileUploadView.file}" multiple="true" mode="simple"
									skinSimple="true" />

								<p:commandButton value="Submit" ajax="false" disabled="true" />
							</h:form>
							
							<p:fieldset style="margin-bottom:10px;">
							
							
							</p:fieldset>
							
						</p:tab>
						
						<p:tab title="#{labels.stats}" disabled="true"></p:tab>

					</p:accordionPanel>

					<hr></hr>
					<p:dialog header="Auftrag löschen" modal="true" widgetVar="delAuftrag" minHeight="40" resizable="false">
						<p>Möchten Sie wirklich diesen Auftrag löschen?</p>
					    <hr></hr>
					    <p:commandButton value="#{labels.ja}" action="#{auftragBean.deleteAuftrag()}" update="nav_form sect_form" oncomplete="PF('delAuftrag').hide();"/>
					    <p:commandButton value="#{labels.nein}" onclick="PF('delAuftrag').hide();"/>
					</p:dialog>

				</div>
			</div>
		</h:form>
	</div>

	<div id="footer"></div>

	<p:dialog id="auftragNewDlg" header="Neuer Auftrag" modal="true" widgetVar="newAuftrag" minHeight="40" resizable="false">
		<ui:include src="/views/secure/dialogs/auftragNew.xhtml"/>
	</p:dialog>
	
</body>
</html>
